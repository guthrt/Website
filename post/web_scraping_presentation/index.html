<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.41" />
  <meta name="author" content="Taylor Guthrie">

  
  
  
  
    
      
    
  
  <meta name="description" content="IntroductionThis presentation is designed to give a cursory overview of the methods involved in extracting data from the web. Web scraping, also known as web crawling or web harvesting, is a technique used to obtain information from a website that is not available in a downloadable form. This is a topic that is unlike any that we have covered so far it in that it requires the use of tools outside of R and R studio and also requires a cursory knowledge of how information on the web is stored.">

  
  <link rel="alternate" hreflang="en-us" href="/post/web_scraping_presentation/">

  


  

  
  
  <meta name="theme-color" content="#0095eb">
  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Academic">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Academic">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/web_scraping_presentation/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Academic">
  <meta property="og:url" content="/post/web_scraping_presentation/">
  <meta property="og:title" content="Web Scraping Workshop Introduction | Academic">
  <meta property="og:description" content="IntroductionThis presentation is designed to give a cursory overview of the methods involved in extracting data from the web. Web scraping, also known as web crawling or web harvesting, is a technique used to obtain information from a website that is not available in a downloadable form. This is a topic that is unlike any that we have covered so far it in that it requires the use of tools outside of R and R studio and also requires a cursory knowledge of how information on the web is stored.">
  <meta property="og:locale" content="en-us">
  
  
  
  

  
  

  <title>Web Scraping Workshop Introduction | Academic</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">Academic</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#teaching">
            
            <span>Teaching</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <h1 itemprop="name">Web Scraping Workshop Introduction</h1>

    

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="0001-01-01 00:00:00 &#43;0000 UTC" itemprop="datePublished dateModified">
      Jan 1, 0001
    </time>
  </span>
  <span itemscope itemprop="author publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Taylor Guthrie">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    8 min read
  </span>
  

  
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="/categories/r/">R</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Web%20Scraping%20Workshop%20Introduction&amp;url=%2fpost%2fweb_scraping_presentation%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2fweb_scraping_presentation%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2fweb_scraping_presentation%2f&amp;title=Web%20Scraping%20Workshop%20Introduction"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2fweb_scraping_presentation%2f&amp;title=Web%20Scraping%20Workshop%20Introduction"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Web%20Scraping%20Workshop%20Introduction&amp;body=%2fpost%2fweb_scraping_presentation%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


    <div class="article-style" itemprop="articleBody">
      <div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This presentation is designed to give a cursory overview of the methods involved in extracting data from the web. Web scraping, also known as web crawling or web harvesting, is a technique used to obtain information from a website that is not available in a downloadable form. This is a topic that is unlike any that we have covered so far it in that it requires the use of tools outside of R and R studio and also requires a cursory knowledge of how information on the web is stored. In order to access the text or images of a website, we must dig through the underlying html code that serves as the scaffold of the website and pull out the bits and pieces that we need.</p>
<p>We will first explore the tools included in the ‘rvest’ package that will allow us to navigate the messy structure of the web. This will be followed by a surface level tutorial of how html code is structured and discuss the ways in which we can use tools such as developer tools, search functions, and web browser extensions to navigate through the code and find what we need. We will then go through two working examples that show different perspectives and techniques that can both achieve similar results.</p>
</div>
<div id="disclaimer" class="section level1">
<h1>Disclaimer!</h1>
<p>Some websites don’t approve of web scraping and have systems in place that identify the difference between a user accessing the website through a point and click interface and a program that is designed to access the page solely to pull information from it. Facebook for example has been known to ban people from using facebook for scraping data. Google also has safeguards in place to prevent scraping as well. Make sure you research the guidelines that are in place for a particular site before trying to extract data from it.</p>
</div>
<div id="rvest" class="section level1">
<h1>rvest</h1>
<p><code>html(x)</code> or <code>read_html(x)</code></p>
<p>Takes a url as its input and parses the html code that is associated with that site. Note that <code>html()</code> is deprecated.</p>
<p><code>html_nodes(x, css, xpath)</code></p>
<p>Turns each HTML tag into a row in an R dataframe. Takes parsed html code as an input and requires either a css selector or an xpath as an argument. This is how you tell R what you want to pull from the website that you have identified with html() or read_html(). Css selectors will be explained below and xpath will not be explained here because it is used for xml.</p>
<p><code>html_text(x)</code></p>
<p>Takes a HTML tags, derived from html_nodes(), as a parameter and extracts text from the corresponding tag(s).</p>
<pre class="r"><code># Store web url
library(rvest)
kingdom &lt;- read_html(&quot;http://www.imdb.com/title/tt0320661/&quot;)

#Scrape the website for the movie rating
rating &lt;- kingdom %&gt;% 
  html_nodes(&quot;strong span&quot;) %&gt;%
  html_text() 
rating</code></pre>
<pre><code>## [1] &quot;7.2&quot;</code></pre>
<p><code>html_attrs()</code></p>
<p>Takes a node or nodes as a parameter and extracts the attributes from them. Can be useful for debugging.</p>
<pre class="r"><code>#html_attrs() instead of html_text()
rating &lt;- kingdom %&gt;% 
  html_nodes(&quot;strong span&quot;) %&gt;%
  html_attrs() 
rating</code></pre>
<pre><code>## [[1]]
##      itemprop 
## &quot;ratingValue&quot;</code></pre>
<p><code>html_session()</code></p>
<p>Alternative to using html() or read_html(). This function essentially opens a live browser session that allows you to do things such as “clicking buttons” and using the back page and forward page options like you would if you were were actually browsing the internet.</p>
<p><code>follow_link()</code> <code>jump_to()</code> <code>back()</code> <code>forward()</code></p>
<p><code>html_table()</code></p>
<p>Scrape whole HTML tables of data as a dataframe</p>
<pre class="r"><code>s &lt;- html_session(&quot;http://hadley.nz&quot;)
s %&gt;% jump_to(&quot;hadley-wickham.jpg&quot;) %&gt;% back() %&gt;% session_history()</code></pre>
<pre><code>## - http://hadley.nz/
##   http://hadley.nz/hadley-wickham.jpg</code></pre>
<pre class="r"><code>s %&gt;% follow_link(css = &quot;p a&quot;)</code></pre>
<pre><code>## &lt;session&gt; https://www.rstudio.com/
##   Status: 200
##   Type:   text/html; charset=UTF-8
##   Size:   654651</code></pre>
</div>
<div id="html-and-css-selectors" class="section level1">
<h1>HTML and CSS selectors</h1>
<p>A css selector is a tag that is used to identify the information within the html code that you need. You rarely want to just pull one number or bit of text from a site or else you would just copy and paste it. The data that you want is often structured in repetitive ways through the use of “tags” and “class” identifiers (to name a few) that allow you to pull all data that has certain qualities in common.</p>
<p>This is a website that is highly recommended by Hadley Wickham for understanding how css selectors work.</p>
<p>flukeout.github.io (demo)</p>
<p><a href="http://selectorgadget.com/">Selector Gadget</a></p>
<p>The developer tools in the Google Chrome browser can also be incredibly helpful to identify relevant CSS tags.</p>
</div>
<div id="scraping-sports-data" class="section level1">
<h1>Scraping Sports Data</h1>
<p>Sports data is a good proof of concept because there are lots of numbers to work with. We will start with week 1 of the regular season and scrape all of the NFL teams that played that week and then also pull the total and quarter scores for each of those teams. Using a for loop we will navigate page by page through each week of the season until we have the teams and scores for the entire season. The data will then take a bit of wrangling to get it into a usable form so we can perform some simple descriptive statistics on it.</p>
<pre class="r"><code>#Load packages
library(rvest)
library(tidyverse)

#Establish the session with the url for the first page  
link &lt;- html_session(&quot;http://www.nfl.com/scores/2017/REG1&quot;)

#create an iteration variable that represents the amount of pages you will need to access
num_weeks &lt;- 17

#each week has a different amount of games and so I make empty lists to put the dataframes in for each page
#I have one for the teams and total scores and one for the teams and the quarter scores 
#It makes it easier to wrangle later on to do these separate 
dfs1 &lt;- list()
dfs2 &lt;- list()

#Create a for loop to iterate through each page and to collect the data on each that you need
for (i in 1:num_weeks) { 
  
  #collect all of the team names for each week
  team &lt;- link  %&gt;% 
    #identify the css selector that selects all team names
    html_nodes(&quot;.team-name&quot;) %&gt;%  
    #parse the html into a usable form
    html_text()
  
  #collect all of the total scores for each week
  score &lt;- link %&gt;% 
    #identify the css selector that selects all total scores
    html_nodes(&quot;.team-data .total-score&quot;) %&gt;%  
    html_text() %&gt;% 
    as.numeric()
  
  #collect the scores for each quarter for each game for each week 
  q1 &lt;- link %&gt;% 
    html_nodes(&quot;.first-qt&quot;) %&gt;% 
    html_text() %&gt;% 
    as.numeric

  q2 &lt;- link %&gt;% 
    html_nodes(&quot;.second-qt&quot;) %&gt;% 
    html_text() %&gt;% 
    as.numeric

  q3 &lt;- link %&gt;% 
    html_nodes(&quot;.third-qt&quot;) %&gt;% 
    html_text() %&gt;% 
    as.numeric

  q4 &lt;- link %&gt;% 
    html_nodes(&quot;.fourth-qt&quot;) %&gt;% 
    html_text() %&gt;% 
    as.numeric
  
  #Create a dataframe that binds togther the team and the total score for each week
  x &lt;- as.data.frame(cbind(team, score))
  #This allows you to keep the teams variable the same in each dataframe while creating a variable that identifies which week the score came from
  colnames(x) &lt;- c(&quot;teams&quot;, paste(&quot;scores_week&quot;, i, sep = &quot;_&quot;))
  
  #Same thing for a dataframe that combines teams and the quarter scores for each week
  y &lt;- as.data.frame(cbind(team, q1, q2, q3, q4))
  #The &quot;_&quot; after the q is very helpful later on
  colnames(y) &lt;- c(&quot;teams&quot;, paste(&quot;q_1_week&quot;, i, sep = &quot;_&quot;), paste(&quot;q_2_week&quot;, i, sep = &quot;_&quot;), paste(&quot;q_3_week&quot;, i, sep = &quot;_&quot;), paste(&quot;q_4_week&quot;, i, sep = &quot;_&quot;))
  
  #assign a name to each dataframe that specifies which week it came from 
  dfs1[[i]] &lt;- x
  dfs2[[i]] &lt;- y
  
  #specify which page to stop on
  if (i &lt; num_weeks) {
    #follow the link for the next page with the approprite css selector 
    link &lt;- link %&gt;%
      follow_link(css = &quot;.active-week+ li .week-item&quot;)
  }
}

#join all of the dataframes based on team name
total &lt;- left_join(dfs1[[1]], dfs1[[2]])

for (i in 3:num_weeks) {
  total &lt;- left_join(total, dfs1[[i]])
}

quarters &lt;- left_join(dfs2[[1]], dfs2[[2]])

for (i in 3:num_weeks) {
  quarters &lt;- left_join(quarters, dfs2[[i]])
}


#put the dataframe into long format
total_tidy &lt;- total %&gt;% 
  gather(week, score, -1) %&gt;% 
  #split up the week variable so that all you have is a number
  separate(week, c(&quot;dis&quot;, &quot;dis2&quot;, &quot;week&quot;), sep = &quot;_&quot;) %&gt;% 
  select(-starts_with(&quot;dis&quot;))

#do the same for the quarter score dataframes 
q_tidy &lt;- quarters %&gt;%
  gather(q, q_score, -1) %&gt;% 
  #this is why the &quot;_&quot; after the q earlier was important 
  separate(q, c(&quot;dis&quot;, &quot;quarter&quot;, &quot;dis2&quot;, &quot;week&quot;), sep = &quot;_&quot;) %&gt;% 
  select(-starts_with(&quot;dis&quot;))

#join the total and quarter dataframes
full_tidy &lt;- left_join(total_tidy, q_tidy)

full_tidy$score &lt;- as.numeric(full_tidy$score)
full_tidy$q_score &lt;- as.numeric(full_tidy$q_score)

week &lt;- full_tidy %&gt;% 
  group_by(week) %&gt;% 
  summarise(mean = mean(score, na.rm = TRUE))

team_score &lt;- full_tidy %&gt;% 
  group_by(teams) %&gt;% 
  summarise(mean = mean(score, na.rm = TRUE))

q_score &lt;- full_tidy %&gt;% 
  group_by(teams, quarter) %&gt;% 
  summarise(mean = mean(q_score, na.rm = TRUE))</code></pre>
</div>
<div id="minihacks" class="section level1">
<h1>Minihacks</h1>
<div id="minihack-1" class="section level2">
<h2>Minihack 1</h2>
<p>Navigate to the nfl page that was used in the first example and pull the big plays count for each game. Once you have all of the data, report the mean and the standard deviation. *If you are feeling ambitious, create a for loop that does this for each week of the season and store each mean and sd in a list.</p>
</div>
<div id="minihack-2" class="section level2">
<h2>Minihack 2</h2>
<p>Go back to the TrustPilot website and look at the reviews. You’ll notice that there is information on each review about the number of reviews the author has posted on the website (Ex: Joey Perry, 4 reviews). Write a function that, for a given webpage, gets the number of reviews each reviewer has made.</p>
<p>If you are having trouble finding the corresponding CSS tag, ask a classmate! Note as well that only pulling the number of other reviews will involve some text manipulation to get rid of irrelevant text.</p>
<p>At the end you should have a function that takes an html object as a parameter and returns a numeric vector of length 20.</p>
</div>
<div id="minihack-3" class="section level2">
<h2>Minihack 3</h2>
<p>The web is a vast ocean of data that is waiting to be scraped. For this hack, be creative. Find a website of your choice and pull some data that you find interesting. Tidy your data and print the head of your dataframe. Perform some simple descriptive statistics and if you’re feeling ambitious create at least one visualization of the trends that you have discovered. There are no limitations to what kind of data you decide to pull (but don’t forget our initial disclaimer!). It can be numbers and it can also be text if you decide that you want to use the skills from the text processing lesson that we covered last week.</p>
<p>If you don’t know where to start, scraping from imdb.com, espn.go.com, news sites, bestplaces.net, is sufficient.</p>
<p>Helpful Sources:</p>
<p><a href="http://blog.rstudio.com/2014/11/24/rvest-easy-web-scraping-with-r/">Hadley Wickham’s rvest</a></p>
<p><a href="https://rpubs.com/ryanthomas/webscraping-with-rvest">RPubs Web Scraping Tutorial</a></p>
<p><a href="https://cran.r-project.org/web/packages/rvest/vignettes/selectorgadget.html">CRAN Selectorgadget</a></p>
</div>
</div>

    </div>

    


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/r-markdown/">R Markdown</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/plot/">plot</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/regression/">regression</a>
  
</div>




    
    

    

    


  </div>
</article>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

